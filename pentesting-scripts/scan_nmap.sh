#!/usr/bin/env bash

# scan_nmap.sh - Script d'automatisation de scan Nmap
# Usage: ./scan_nmap.sh <target> [-p <ports>] [-o <output_file>]
# Exemple:
#   ./scan_nmap.sh 192.168.1.0/24
#   ./scan_nmap.sh example.com -p 80,443
#   ./scan_nmap.sh 10.0.0.5 -o resultat.txt
#   ./scan_nmap.sh 10.0.0.0/24 -p 22,80 -o scan_reseau.txt

# Vérifie qu’au moins une cible est spécifiée
if [ $# -lt 1 ]; then
  echo "Usage: $0 <target> [-p <ports>] [-o <output_file>]"
  exit 1
fi

# Variables par défaut
TARGET=""
PORTS=""
OUTPUT=""

# Lecture des arguments
while [[ $# -gt 0 ]]; do
  case "$1" in
    -p|--ports)
      PORTS="$2"
      shift 2
      ;;
    -o|--output)
      OUTPUT="$2"
      shift 2
      ;;
    *)
      if [[ -z "$TARGET" ]]; then
        TARGET="$1"
        shift
      else
        echo "Argument inconnu : $1"
        exit 1
      fi
      ;;
  esac
done

# Construction de la commande Nmap
CMD=(nmap -sV -T4)
if [[ -n "$PORTS" ]]; then
  CMD+=(-p "$PORTS")
fi
CMD+=("$TARGET")

# Gérer la sortie dans un fichier si demandé
if [[ -n "$OUTPUT" ]]; then
  CMD+=(-oN "$OUTPUT")
fi

# Affichage et exécution
echo "Exécution de : ${CMD[*]}"
"${CMD[@]}"
